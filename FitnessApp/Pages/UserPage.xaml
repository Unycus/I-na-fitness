<Page x:Class="FitnessApp.Pages.UserPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Title="Личный кабинет">

    <TabControl x:Name="tabControl" SelectionChanged="TabControl_SelectionChanged">
        <!-- Вкладка 1: Личная информация -->
        <TabItem Header="Мои данные">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="20" Width="400">
                    <TextBlock Text="Личная информация" FontSize="20" FontWeight="Bold" Margin="0,0,0,20"/>

                    <TextBlock Text="ФИО:" Margin="0,5"/>
                    <TextBox x:Name="txtFullName" Margin="0,0,0,15"/>

                    <TextBlock Text="Email:" Margin="0,5"/>
                    <TextBox x:Name="txtEmail" Margin="0,0,0,15"/>

                    <TextBlock Text="Телефон:" Margin="0,5"/>
                    <TextBox x:Name="txtPhone" Margin="0,0,0,15"/>

                    <TextBlock Text="Дата рождения:" Margin="0,5"/>
                    <DatePicker x:Name="dpBirthDate" Margin="0,0,0,20"/>

                    <Button Content="Сохранить изменения" Click="BtnSave_Click"
                           Background="#FF4CAF50" Foreground="White" 
                           Height="35" FontWeight="Bold"/>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Вкладка 2: Запись на тренировки -->
        <TabItem Header="Запись на тренировки">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Фильтры расписания -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="10" Background="#F5F5F5">
                    <TextBlock Text="Показать:" VerticalAlignment="Center" Margin="10,10,10,10"/>
                    <ComboBox x:Name="cmbScheduleFilter" SelectionChanged="CmbScheduleFilter_SelectionChanged"
                             Width="150" Height="30" Margin="0,10,10,10">
                        <ComboBoxItem Content="Все тренировки" IsSelected="True"/>
                        <ComboBoxItem Content="Только доступные"/>
                        <ComboBoxItem Content="Только мои записи"/>
                    </ComboBox>
                </StackPanel>

                <!-- Расписание -->
                <DataGrid x:Name="dgSchedule" AutoGenerateColumns="False" 
                         IsReadOnly="True" Margin="10" Grid.Row="1"
                         ItemsSource="{Binding AvailableSchedules}">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Услуга" Binding="{Binding Service.Name}" Width="*"/>
                        <DataGridTextColumn Header="Тренер" Binding="{Binding TrainerName}" Width="150"/>
                        <DataGridTextColumn Header="Дата и время" Width="150">
                            <DataGridTextColumn.Binding>
                                <Binding Path="StartTime">
                                    <Binding.StringFormat>dd.MM.yyyy HH:mm</Binding.StringFormat>
                                </Binding>
                            </DataGridTextColumn.Binding>
                        </DataGridTextColumn>
                        <DataGridTemplateColumn Header="Длительность" Width="100">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock HorizontalAlignment="Center">
                                        <TextBlock.Text>
                                            <Binding Path="Service.Duration" StringFormat="{}{0} мин"/>
                                        </TextBlock.Text>
                                    </TextBlock>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn Header="Свободно мест" Binding="{Binding FreeSpots}" Width="100"/>
                        <DataGridTemplateColumn Width="120">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button Content="Записаться" Click="BookButton_Click"
                                           Tag="{Binding ScheduleId}"
                                           IsEnabled="{Binding CanBook}"
                                           Background="#FF4CAF50" 
                                           Foreground="White"
                                           Margin="5"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>

                <TextBlock x:Name="txtNoSchedules" Grid.Row="1" Text="Нет доступных тренировок" 
                          HorizontalAlignment="Center" VerticalAlignment="Center"
                          FontSize="16" Foreground="Gray" Visibility="Collapsed"/>

                <!-- Мои записи -->
                <StackPanel Grid.Row="2" Margin="10" Background="#F0F8FF">
                    <TextBlock Text="Мои текущие записи:" FontWeight="Bold" Margin="10,10,10,10"/>
                    <DataGrid x:Name="dgMyBookings" AutoGenerateColumns="False" 
                             IsReadOnly="True" Height="150" Margin="10,0,10,10">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Тренировка" Binding="{Binding Schedule.Service.Name}" Width="*"/>
                            <DataGridTextColumn Header="Дата" Width="150">
                                <DataGridTextColumn.Binding>
                                    <Binding Path="Schedule.StartTime">
                                        <Binding.StringFormat>dd.MM.yyyy HH:mm</Binding.StringFormat>
                                    </Binding>
                                </DataGridTextColumn.Binding>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="Статус" Binding="{Binding Status}" Width="100"/>
                            <DataGridTemplateColumn Width="100">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="Отменить" Click="CancelBookingButton_Click"
                                               Tag="{Binding BookingId}"
                                               Background="#FFF44336" 
                                               Foreground="White"
                                               Margin="5"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>
            </Grid>
        </TabItem>

        <!-- Вкладка 3: Мои услуги и абонементы -->
        <TabItem Header="Мои услуги">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <DataGrid x:Name="dgUserServices" AutoGenerateColumns="False" 
                         IsReadOnly="True" Margin="10" Grid.Row="0"
                         ItemsSource="{Binding UserServices}">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Услуга" Binding="{Binding Service.Name}" Width="*"/>
                        <DataGridTextColumn Header="Дата покупки" Width="120">
                            <DataGridTextColumn.Binding>
                                <Binding Path="PurchaseDate">
                                    <Binding.StringFormat>dd.MM.yyyy</Binding.StringFormat>
                                </Binding>
                            </DataGridTextColumn.Binding>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Действует до" Width="120">
                            <DataGridTextColumn.Binding>
                                <Binding Path="ExpiryDate">
                                    <Binding.StringFormat>dd.MM.yyyy</Binding.StringFormat>
                                </Binding>
                            </DataGridTextColumn.Binding>
                        </DataGridTextColumn>
                        <DataGridTemplateColumn Header="Статус" Width="100">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock HorizontalAlignment="Center">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Text" Value="Неактивен"/>
                                                <Setter Property="Foreground" Value="Red"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsActive}" Value="True">
                                                        <Setter Property="Text" Value="Активен"/>
                                                        <Setter Property="Foreground" Value="Green"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>

                <TextBlock x:Name="txtNoServices" Grid.Row="0" Text="У вас нет приобретенных услуг" 
                          HorizontalAlignment="Center" VerticalAlignment="Center"
                          FontSize="16" Foreground="Gray" Visibility="Collapsed"/>

                <!-- Кнопка покупки новых услуг -->
                <Button Grid.Row="1" Content="Купить новые услуги" Click="BtnBuyServices_Click"
                       HorizontalAlignment="Right" Margin="10" 
                       Background="#FF4CAF50" Foreground="White" FontWeight="Bold"
                       Padding="15,10"/>
            </Grid>
        </TabItem>
    </TabControl>
</Page>